<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>USA visa date notification signup</title>

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
  </head>

  <body class="container my-5">
    <h1 class="text-center">
      Signup to get email notifications for available USA visa dates
    </h1>

    <form id="signup-form" class="mt-5">
      <div class="mb-3">
        <label for="username" class="form-label">Email address*</label>
        <input
          type="text"
          class="form-control"
          id="username"
          aria-describedby="usernameHelp"
          required
        />
        <div id="usernameHelp" class="form-text">
          The email address you have registered with on
          <a
            href="https://ais.usvisa-info.com/en-ca/niv/users/sign_in"
            class="link-primary"
            >USA visa website</a
          >.
        </div>
      </div>
      <div class="mb-3">
        <label for="password" class="form-label">Password*</label>
        <input
          type="password"
          class="form-control"
          id="password"
          aria-describedby="passwordHelp"
          required
        />
        <p id="show-password" class="link-primary">Show password</p>
        <div id="passwordHelp" class="form-text">
          The password used to log into
          <a
            href="https://ais.usvisa-info.com/en-ca/niv/users/sign_in"
            class="link-primary"
            >USA visa website</a
          >
          with the above email address.
        </div>
      </div>
      <div class="mb-3">
        <label for="email" class="form-label">Email address*</label>
        <input
          type="email"
          class="form-control"
          id="email"
          aria-describedby="emailHelp"
          required
        />
        <div id="emailHelp" class="form-text">
          You'll get notification on this email address.
        </div>
      </div>
      <div class="mb-3">
        <button id="submit-btn" class="btn btn-primary">Submit</button>
      </div>
    </form>

    <!-- Script -->
    <script>
      const form = document.querySelector("#signup-form");
      const submitBtn = document.querySelector("#submit-btn");
      const showPassword = document.querySelector("#show-password");

      showPassword.addEventListener("click", () => {
        const password = document.querySelector("#password");
        if (password.type === "password") {
          password.type = "text";
          showPassword.innerText = "Hide password";
        } else {
          password.type = "password"
          showPassword.innerText = "Show password";
        }
      });

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        if (confirm("Please check the login email and password for USA website is correct")) {
          submitBtn.disabled = true;
          submitBtn.innerText = "Submitting...";
          const formData = {
            username: form.querySelector("#username").value,
            password: form.querySelector("#password").value,
            email: form.querySelector("#email").value,
          };
  
          fetch("/signup", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(formData),
          })
            .then((res) => res.json())
            .then((data) => {
              alert(data.message)
            })
            .catch((err) => {
              alert("Error signing up!")
            })
            .finally(() => {
              submitBtn.disabled = false;
              submitBtn.innerText = "Submit";
            });
        }
      });
    </script>
  </body>
</html>
